"use strict";(self.webpackChunkjustlend_front=self.webpackChunkjustlend_front||[]).push([[643],{69185:(e,t,s)=>{s.d(t,{A:()=>v});var i,o=s(76998),a=s(98859),n=s(33270),l=s(48634),r=s(96843),d=s(75659),c=(s(83933),s(80646),s(23446));const v=(0,a.WQ)("network")(i=(0,a.WQ)("lend")(i=(0,a.WQ)("system")(i=(0,a.PA)(i=class extends o.Component{constructor(){var e;super(),e=this,this.startInterval=async()=>{this.timerInterval||(this.timerInterval=setInterval((async()=>{}),3e3))},this.componentDidMount=()=>{this.startInterval()},this.withdrawVotes=async e=>{window.gtag("event","PC_recycle_votes_modal",{event_category:"PC_V1.5",event_label:"recycle_votes_modal"}),this.setState({clickProposalId:e}),this.props.system.clearRejectError();const{oldVoteLastId:t}=d.Ay;let s={proposalId:e,contractAddr:e<=t?d.Ay.contract.oldWJSTAddress:d.Ay.contract.WJSTAddress};const i={title:"toast.ex",title2:"deposit.transactionsent",title3:"toast.ex_failed",title4:"deposit.confirm_transaction",obj:{value:s.votes,token:s.proposalId||""},transType:"withdrawVotes"},o=s.contractAddr;let a=[{type:"uint256",value:s.proposalId}];const n={feeLimit:await this.props.system.getFeeLimitCommon(o,"withdrawVotes(uint256)",a)};await this.props.system.withdrawVotes(s,i,n)?(window.gtag("event","PC_recycle_votes_modal_success",{event_category:"PC_V1.5",event_label:"recycle_votes_modal_success"}),this.props.lend.setData({redeemFromVotePop:!1}),this.setState({clickProposalId:""})):this.setState({clickProposalId:""})},this.renderVoting=function(t){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{voteSourceData:i}=e.props.lend,{lang:o,clickProposalId:a}=e.state;if((null===t||void 0===t?void 0:t.length)>0)return null===t||void 0===t?void 0:t.map(((t,l)=>{var d,v;const p=(0,n.gH)(t.allVotes).eq(0)?"0":(0,n.gH)(t.allVotes).lt(.001)?"< 0.001":(0,n.ZV)(t.allVotes,3);return(0,c.jsxs)("div",{className:"vote-detail-item",children:[(0,c.jsxs)("div",{className:"hide-md",children:[(0,c.jsxs)("div",{className:"proposalId",children:["#",null===t||void 0===t?void 0:t.proposalId]}),(0,c.jsx)("div",{className:"title "+("en-US"===o?"":"zh"),children:i&&null!==(d=i[null===t||void 0===t?void 0:t.proposalId])&&void 0!==d&&d.title?"en-US"===o?i[t.proposalId].title.split("&&")[1]:i[t.proposalId].title.split("&&")[0]:""}),(0,c.jsx)("div",{className:"amount ellipsis",title:p,children:p}),s&&(a?a===t.proposalId?(0,c.jsx)("div",{className:"link disabled",children:(0,c.jsx)("span",{className:"siging-icon"})}):(0,c.jsx)("div",{className:"link disabled",children:r.Ay.get("v2.vote.redeem_vote_btn")}):(0,c.jsx)("div",{className:"link",onClick:()=>e.withdrawVotes(t.proposalId),children:r.Ay.get("v2.vote.redeem_vote_btn")}))]}),(0,c.jsxs)("div",{className:"hide-pc",children:[(0,c.jsxs)("div",{className:"proposalId",children:["#",null===t||void 0===t?void 0:t.proposalId]}),(0,c.jsxs)("div",{className:"middle-part",children:[(0,c.jsx)("div",{className:"title "+("en-US"===o?"":"zh"),children:i&&null!==(v=i[null===t||void 0===t?void 0:t.proposalId])&&void 0!==v&&v.title?"en-US"===o?i[t.proposalId].title.split("&&")[1]:i[t.proposalId].title.split("&&")[0]:""}),(0,c.jsx)("div",{className:"amount ellipsis",title:p,children:p})]}),s&&(a?a===t.proposalId?(0,c.jsx)("div",{className:"link disabled",children:(0,c.jsx)("span",{className:"siging-icon"})}):(0,c.jsx)("div",{className:"link disabled",children:r.Ay.get("v2.vote.redeem_vote_btn")}):(0,c.jsx)("div",{className:"link",onClick:()=>e.withdrawVotes(t.proposalId),children:r.Ay.get("v2.vote.redeem_vote_btn")}))]})]},l)}))},this.timerInterval=null,this.state={lang:window.localStorage.getItem("lang")||r.Ay.options.currentLocale,visible:!1,clickProposalId:""}}componentWillUnmount(){clearInterval(this.timerInterval),this.timerInterval=null}render(){const{userCanRedeemVoteList:e,userVotingVote:t,voteDetailModalVisible:s,userCanRedeemVoteNum:i,theme:o}=this.props.lend,{clickProposalId:a}=this.state,{transModalInfo:d}=this.props.system,{declined:v,transType:p}=d,h=(0,n.gH)(i).eq(0)?0:(0,n.ZV)(i,3,{miniText:.001});return(0,c.jsxs)(l.A,{title:r.Ay.get("v2.vote.recovered_vote"),maskClosable:!1,visible:s,closable:!0,onCancel:()=>{this.props.system.clearRejectError(),this.props.lend.setData({voteDetailModalVisible:!1}),window.gtag("event","PC_recycle_votes_close",{event_category:"PC_V1.5",event_label:"recycle_votes_close"})},footer:null,className:`vote-detail-modal-v2 ${o}`,width:457,centered:!0,children:[(0,c.jsx)("div",{className:"tick-vote-logo"}),(0,c.jsx)("p",{className:"redeemNum",children:r.Ay.getHTML("v2.vote.recover_vote",{value:h})}),t&&(null===t||void 0===t?void 0:t.length)>0||e&&(null===e||void 0===e?void 0:e.length)>0?(0,c.jsxs)("div",{className:"vote-detail-container",children:[e.length>4&&(0,c.jsx)("div",{className:"linear"}),e&&(null===e||void 0===e?void 0:e.length)>0&&(0,c.jsx)(c.Fragment,{children:(0,c.jsx)("div",{className:"box",children:this.renderVoting(e,!0)})}),a?(0,c.jsx)("div",{className:"info",children:(0,c.jsxs)("div",{className:"j-sign-tip flex aic jcc",children:[(0,c.jsx)("span",{className:"j-warning-icon"}),(0,c.jsx)("span",{children:r.Ay.get("v2.sign_in_wallet")})]})}):v&&"withdrawVotes"===p&&(0,c.jsx)("div",{className:"info",children:(0,c.jsxs)("div",{className:"j-reject-tip",children:[(0,c.jsx)("span",{className:"j-reject-img mt-3"}),(0,c.jsx)("span",{children:r.Ay.get("v2.reject_in_wallet")})]})})]}):null]})}})||i)||i)||i)||i},77643:(e,t,s)=>{s.r(t),s.d(t,{default:()=>J});var i=s(76998),o=s(96843),a=s(59866),n=s(87207),l=s.n(n),r=s(98859),d=s(26559),c=s(65506),v=s(67441),p=s(89379);const h={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"};var m=s(76228),g=function(e,t){return i.createElement(m.A,(0,p.A)((0,p.A)({},e),{},{ref:t,icon:h}))};g.displayName="EditOutlined";const _=i.forwardRef(g);var u,j=s(68111),x=s(25034),y=s(75659),w=s(33270),N=s(13412),A=s(93995),b=s(42780),S=s(19523),V=s(48634),P=s(40437),f=(s(83933),s(80646),s(23446));const C=(0,r.WQ)("lend")(u=(0,r.WQ)("system")(u=(0,r.PA)(u=class extends i.Component{constructor(e){super(e),this.hideRedeemFromVotePop=()=>{this.props.system.clearRejectError(),this.setState({isSigning:!1}),this.props.lend.setData({redeemFromVotePop:!1}),window.gtag("event","PC_vote_detail_recycle_close",{event_category:"PC_V1.5",event_label:"vote_detail_recycle_close"})},this.withdrawVotes=async()=>{this.props.system.clearRejectError(),window.gtag("event","PC_vote_detail_recycle_btn",{event_category:"PC_V1.5",event_label:"vote_detail_recycle_btn"}),this.setState({isSigning:!0});const{lockNum:e,redeemFromVotePopProposalId:t}=this.props.lend;let s={proposalId:t,contractAddr:y.Ay.contract.WJSTAddress};const i={title:"toast.ex",title2:"deposit.transactionsent",title3:"toast.ex_failed",title4:"deposit.confirm_transaction",obj:{value:s.votes,token:s.proposalId||""},transType:"withdrawVote"};try{await this.props.system.withdrawVotes(s,i)?(window.gtag("event","PC_vote_detail_recycle_success",{event_category:"PC_V1.5",event_label:"vote_detail_recycle_success"}),this.hideRedeemFromVotePop()):this.setState({isSigning:!1})}catch{this.setState({isSigning:!1})}},this.state={isSigning:!1}}render(){const{redeemFromVotePop:e,lockNum:t}=this.props.lend,{transModalInfo:s}=this.props.system,{declined:i,transType:a}=s,{isSigning:n}=this.state;var r,d="--";if(t&&t.gt(0)){const e=(0,w.gH)(t).div(y.Ay.tokenDefaultPrecision);d=(0,w.gH)(e).lt(.001)?"< 0.001":(0,w.ZV)(e,3)}return r=n?o.Ay.get("v2.sign_in_wallet"):o.Ay.get("v2.vote.redeem_vote_modal_btn"),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(V.A,{visible:e,title:o.Ay.get("v2.vote.redeem_vote_modal_title"),width:400,footer:null,className:"j-modal header-border redeem-vote-pop",onCancel:()=>this.hideRedeemFromVotePop(),closable:!0,maskClosable:!1,centered:!0,getContainer:()=>document.querySelector(".j-wrapper"),children:[(0,f.jsxs)("div",{className:"modal-content-container",children:[(0,f.jsx)("div",{className:"content-icon"}),(0,f.jsx)("div",{className:"content-title",children:o.Ay.getHTML("v2.vote.redeem_vote_modal_content_title",{value:d})}),(0,f.jsx)("div",{className:"content-subtitle",children:o.Ay.get("v2.vote.redeem_vote_modal_content_subtitle")})]}),(0,f.jsxs)("button",{className:l()("j-large-btn",{"is-signing":n}),disabled:n,onClick:()=>{this.withdrawVotes()},children:[r,(0,f.jsx)("span",{className:"siging-icon"})]}),i&&"withdrawVote"===a&&(0,f.jsxs)("div",{className:"j-error-tip wallet-reject",children:[(0,f.jsx)("span",{className:"j-error-img"}),(0,f.jsx)("div",{children:o.Ay.get("v2.reject_in_wallet")})]})]}),(0,f.jsx)(P.A,{})]})}})||u)||u)||u;var k;const I=(0,r.WQ)("lend")(k=(0,r.WQ)("system")(k=(0,r.WQ)("network")(k=(0,r.PA)(k=class extends i.Component{constructor(e){super(e),this.componentDidMount=async()=>{this.props.network.isConnected&&this.getMountedData(),this.props.network.on("connect",(()=>{this.getMountedData()}))},this.getMountedData=async()=>{await this.props.lend.getUserWithdrawInfo()},this.hideVoteForPop=()=>{this.setState({isSigning:!1,voteInputValue:"",inputErrorText:""}),this.props.lend.setData({voteForPop:!1})},this.getRedeemableVote=()=>{this.props.lend.setData({voteDetailModalVisible:!0}),this.hideVoteForPop(),window.gtag("event","PC_vote_detail_redeem_votes",{event_category:"PC_V1.5",event_label:"vote_detail_redeem_votes"})},this.getVote=()=>{this.props.system.clearRejectError(),this.props.lend.setData({swapJstToVoteModalVisible:!0}),this.hideVoteForPop(),window.gtag("event","PC_vote_detail_get_votes",{event_category:"PC_V1.5",event_label:"vote_detail_get_votes"})},this.getJst=()=>{window.open(`${y.Ay.sunSwap}?lang=${this.state.lang}?tokenAddress=${y.Ay.contract.JST}&type=swap`,"_blank","noreferrer"),this.hideVoteForPop(),window.gtag("event","PC_vote_detail_get_JST",{event_category:"PC_V1.5",event_label:"vote_detail_get_JST"})},this.maxRender=()=>(0,f.jsx)("div",{className:"max-value-button",onClick:this.chooseMax,children:o.Ay.get("v2.max")}),this.chooseMax=()=>{const{voteInfo:e}=this.props.lend;let t=(0,w.ZV)(e.surplusVotes.div(y.Ay.tokenDefaultPrecision),3,{per:!0});this.setState({voteInputValue:t})},this.voteInputValueOnChange=e=>{const{valid:t,str:s}=(0,w.PY)(e,3);if(t){this.setState({voteInputValue:s});const{voteInfo:e}=this.props.lend;e&&e.success&&e.surplusVotes.div(y.Ay.tokenDefaultPrecision).lt((0,w.gH)(s))?this.setState({inputErrorText:o.Ay.get("v2.vote.vote_modal_insufficient_vote")}):this.setState({inputErrorText:""})}},this.vote=async()=>{this.props.system.clearRejectError(),this.setState({isSigning:!0});const{voteInputValue:e}=this.state,{lockNum:t,voteForPopIsFor:s,voteForPopProposalId:i}=this.props.lend;t&&(0,w.gH)(t).gt(0)?window.gtag("event","PC_vote_btn",{event_category:"PC_V1.5",event_label:"vote_btn"}):window.gtag("event","PC_add_vote_btn",{event_category:"PC_V1.5",event_label:"add_vote_btn"});let o={proposalId:i,support:s,votes:(0,w.gH)(e).times(y.Ay.tokenDefaultPrecision)._toHex(),contractAddr:y.Ay.contract.governorAlphaAddress,totalVotes:(0,w.gH)(e).times(y.Ay.tokenDefaultPrecision).plus(t)._toHex()};const a={title:"toast.ex",title2:"deposit.transactionsent",title3:"toast.ex_failed",title4:"deposit.confirm_transaction",needCallAgain:"getVoteDetail",obj:{value:o.votes,token:o.proposalId||""},transType:"vote"};try{await this.props.system.castVote(o,a)?(window.gtag("event","PC_vote_success",{event_category:"PC_V1.5",event_label:"vote_success"}),this.hideVoteForPop(),setTimeout((()=>{this.props.lend.getVoteDetail(i)}),5e3)):this.setState({isSigning:!1})}catch(n){this.setState({isSigning:!1})}},this.state={lang:window.localStorage.getItem("lang")||o.Ay.options.currentLocale,isSigning:!1,voteInputValue:"",inputErrorText:""}}render(){const{voteForPop:e,voteForPopIsFor:t,voteForPopProposalId:s,lockNum:i,voteInfo:a,userCanRedeemVoteNum:n}=this.props.lend,{transModalInfo:r}=this.props.system,{declined:d,transType:c}=r,{isSigning:p,voteInputValue:h,inputErrorText:m}=this.state;var g,_,u,j,x,N=!1,A=!1,b=!1,S="--",P="--",C="--",k=i&&(0,w.gH)(i).gt(0),I="--";if(a&&a.success){const e=(0,w.gH)(a.surplusVotes),t=(0,w.gH)(a.jstBalance),s=(0,w.gH)(n);N=e.gt(0),A=t.gt(0),b=s.gt(0),S=(0,w.ZV)(e.div(y.Ay.tokenDefaultPrecision),3,{miniText:.001}),P=(0,w.ZV)(t.div(y.Ay.tokenDefaultPrecision),3,{miniText:.001}),C=(0,w.gH)(n).eq(0)?0:(0,w.ZV)(n,3,{miniText:.001})}if(k){const e=(0,w.gH)(i).div(y.Ay.tokenDefaultPrecision);I=(0,w.gH)(e).lt(.001)?"< 0.001":(0,w.ZV)(e,3)}return N?(g=o.Ay.get("v2.vote.vote_modal_title",{value:s}),x=!0,k?(_=(0,f.jsx)("span",{className:"vote-title",children:I}),u=t?o.Ay.get("v2.vote.vote_modal_content_title_voted_for",{value:s}):o.Ay.get("v2.vote.vote_modal_content_title_voted_against",{value:s})):(_=t?o.Ay.getHTML("v2.vote.vote_modal_content_title_will_vote_for",{value:s}):o.Ay.getHTML("v2.vote.vote_modal_content_title_will_vote_against",{value:s}),u=""),j=p?o.Ay.get("v2.sign_in_wallet"):t?o.Ay.get("v2.vote.cast_for_votes"):o.Ay.get("v2.vote.cast_against_votes")):(g=o.Ay.get("v2.vote.vote_modal_title_no_vote"),x=!1,b?(_=o.Ay.getHTML("v2.vote.vote_modal_content_title_vote_to_redeem",{value:C}),j=o.Ay.get("v2.vote.vote_modal_action_btn_vote_to_redeem"),u=o.Ay.get("v2.vote.vote_modal_redeem_vote")):A?(_=o.Ay.getHTML("v2.vote.vote_modal_content_title_no_vote",{value:P}),j=o.Ay.get("v2.vote.vote_modal_action_btn_no_vote"),u=o.Ay.get("v2.vote.vote_modal_swap_jst")):(_=o.Ay.get("v2.vote.vote_modal_content_title_no_jst"),j=o.Ay.get("v2.vote.vote_modal_action_btn_no_jst"),u="")),(0,f.jsxs)(V.A,{visible:e,title:g,width:400,footer:null,className:"j-modal header-border vote-pop",onCancel:()=>{this.props.system.clearRejectError(),this.hideVoteForPop(),window.gtag("event","PC_vote_detail_vote_close",{event_category:"PC_V1.5",event_label:"vote_detail_vote_close"})},closable:!0,maskClosable:!1,centered:!0,getContainer:()=>document.querySelector(".j-wrapper"),children:[(0,f.jsxs)("div",{className:l()("modal-content-container",{"have-input":N}),children:[(0,f.jsx)("div",{className:l()("content-icon",{"no-vote":!N&&!b})}),(0,f.jsx)("div",{className:"content-title",children:_}),u&&(0,f.jsx)("div",{className:"content-subtitle",children:u}),x&&(0,f.jsxs)("div",{className:"input-container",children:[(0,f.jsxs)("div",{className:"input-header",children:[(0,f.jsx)("div",{className:"input-title",children:k?o.Ay.getHTML("v2.vote.vote_modal_add_vote_count"):o.Ay.getHTML("v2.vote.vote_modal_vote_count")}),(0,f.jsxs)("div",{className:"remaining-votes",children:[(0,f.jsx)("div",{className:"text",children:o.Ay.get("v2.vote.vote_modal_remaining_vote")}),(0,f.jsx)("div",{className:"balance",children:S})]})]}),(0,f.jsx)(v.A,{className:"j-input "+(m?"j-error-input":""),value:(0,w.QA)(h),placeholder:t?o.Ay.get("v2.vote.vote_modal_input_hint"):o.Ay.get("v2.vote.vote_modal_input_against_hint"),addonAfter:this.maxRender(),onChange:e=>this.voteInputValueOnChange((0,w.DS)(e.target.value)),allowClear:!0,disabled:!!p}),(0,f.jsxs)("div",{className:l()("j-error-tip",{"show-error":m}),children:[(0,f.jsx)("span",{className:"j-error-img"}),(0,f.jsx)("div",{children:m})]})]})]}),(0,f.jsxs)("button",{className:l()("j-large-btn",{"is-signing":N&&p}),disabled:N&&(p||m||!h||"0"==h),onClick:()=>{N?this.vote():b?this.getRedeemableVote():A?this.getVote():this.getJst()},children:[j,(0,f.jsx)("span",{className:"siging-icon"})]}),d&&"vote"===c&&(0,f.jsxs)("div",{className:"j-error-tip wallet-reject",children:[(0,f.jsx)("span",{className:"j-error-img"}),(0,f.jsx)("div",{children:o.Ay.get("v2.reject_in_wallet")})]})]})}})||k)||k)||k)||k;var T;const D=(0,r.WQ)("lend")(T=(0,r.WQ)("system")(T=(0,r.WQ)("network")(T=(0,r.PA)(T=class extends i.Component{constructor(e){super(e),this.hideSwapJstToVotePop=()=>{this.setState({isSigning:!1,jstInputValue:"",inputErrorText:""}),this.props.lend.setData({swapJstToVoteModalVisible:!1}),window.gtag("event","PC_vote_detail_get_votes_close",{event_category:"PC_V1.5",event_label:"vote_detail_get_votes_close"})},this.componentDidMount=async()=>{this.props.network.isConnected&&this.getMountedData(),this.props.network.on("connect",(()=>{this.getMountedData()}))},this.getMountedData=async()=>{let e=await this.getApprove();this.setState({approveStatus:e,approving:!1},(()=>{this.props.lend.getBalanceForVote(),this.props.lend.getOldWjstBalanceForVote()}))},this.getApprove=async()=>{try{let e={collateralAddress:y.Ay.contract.JST,jtokenAddress:y.Ay.contract.WJSTAddress,precision:y.Ay.tokenDefaultPrecision},t=await this.props.lend.getVoteBalanceOf(e);return(0,w.gH)(t).gt(0)}catch(e){return console.log("getApprove, ",e),!1}},this.maxRender=()=>(0,f.jsx)("div",{className:"max-value-button",onClick:this.chooseMax,children:o.Ay.get("vote.voteto_input_max")}),this.chooseMax=()=>{const{voteInfo:e}=this.props.lend;let t=(0,w.ZV)(e.jstBalance.div(y.Ay.tokenDefaultPrecision),3,{per:!0});this.setState({jstInputValue:t})},this.jstInputValueOnChange=e=>{const{valid:t,str:s}=(0,w.PY)(e,3);if(t){this.setState({jstInputValue:s});const{voteInfo:e}=this.props.lend;e&&e.success&&e.jstBalance.div(y.Ay.tokenDefaultPrecision).lt((0,w.gH)(s))?this.setState({inputErrorText:o.Ay.get("tab.not_enough")}):this.setState({inputErrorText:""})}},this.swap=async()=>{this.props.system.clearRejectError();const{jstInputValue:e}=this.state;this.setState({isSigning:!0});const t={collateralAddress:y.Ay.contract.JST,jtokenAddress:y.Ay.contract.WJSTAddress,amount:(0,w.gH)(e).times(y.Ay.tokenDefaultPrecision)._toHex()},s={title:"toast.ex",title2:"deposit.transactionsent",title3:"toast.ex_failed",title4:"deposit.confirm_transaction",obj:{value:t.collateralSymbol},transType:"swapVote"};try{await this.props.system.voteDeposit(t,s)?this.hideSwapJstToVotePop():this.setState({isSigning:!1})}catch{this.setState({isSigning:!1})}},this.toApprove=async()=>{this.props.system.clearRejectError();const e={collateralAddress:y.Ay.contract.JST,jtokenAddress:y.Ay.contract.WJSTAddress,transType:"approve"};this.setState({isSuccess:!1,txID:"",approving:!0});await this.props.system.approveToken(e,[["lend/hideAuthorizePop"]])&&this.setState({approveStatus:!0}),this.setState({approving:!1})},this.renderSwapPop=()=>{const{voteInfo:e}=this.props.lend,{isSigning:t,jstInputValue:s,inputErrorText:i}=this.state,{transModalInfo:a}=this.props.system,{declined:n,transType:r}=a;let d,c,p="--";if(e&&e.success){const t=(0,w.gH)(e.jstBalance);p=(0,w.ZV)(t.div(y.Ay.tokenDefaultPrecision),3,{miniText:.001})}return d=o.Ay.getHTML("v2.vote.get_vote_modal_text"),c=t?o.Ay.get("v2.sign_in_wallet"):o.Ay.get("v2.vote.deposit_now"),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:l()("modal-content-container","have-input"),children:[(0,f.jsx)("div",{className:"content-icon"}),(0,f.jsx)("div",{className:"content-title",children:d}),(0,f.jsxs)("div",{className:"input-container",children:[(0,f.jsxs)("div",{className:"input-header",children:[(0,f.jsx)("div",{className:"input-title",children:o.Ay.getHTML("vote.deposit_amount")}),(0,f.jsxs)("div",{className:"remaining-votes",children:[(0,f.jsx)("div",{className:"text",children:o.Ay.get("wallet_ballance")}),(0,f.jsx)("div",{className:"balance",children:p})]}),(0,f.jsx)("a",{className:"get-jst-link",target:"_blank",rel:"noopener noreferrer",href:`${y.Ay.sunSwap}?lang=${this.state.lang}?tokenAddress=${y.Ay.contract.JST}&type=swap`,children:o.Ay.get("lend.get")})]}),(0,f.jsx)(v.A,{className:"j-input "+(i?"j-error-input":""),value:(0,w.QA)(s),placeholder:o.Ay.get("vote.convert_input_tips"),addonAfter:this.maxRender(),onChange:e=>this.jstInputValueOnChange((0,w.DS)(e.target.value)),allowClear:!0,disabled:!!t}),(0,f.jsxs)("div",{className:l()("j-error-tip",{"show-error":i}),children:[(0,f.jsx)("span",{className:"j-error-img"}),(0,f.jsx)("div",{children:i})]})]})]}),(0,f.jsxs)("button",{className:l()("j-large-btn",{"is-signing":t}),disabled:t||i||!s||"0"==s,onClick:()=>{this.swap()},children:[c,(0,f.jsx)("span",{className:"siging-icon"})]}),n&&"swapVote"===r&&(0,f.jsxs)("div",{className:"j-error-tip wallet-reject",children:[(0,f.jsx)("span",{className:"j-error-img"}),(0,f.jsx)("div",{children:o.Ay.get("v2.reject_in_wallet")})]})]})},this.renderApprovePop=()=>{const{approving:e}=this.state,{transModalInfo:t}=this.props.system,{declined:s,transType:i}=t;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:"modal-content-container",children:[(0,f.jsx)("div",{className:"vote-authorize-logo"}),(0,f.jsx)("div",{className:"content-title",children:o.Ay.getHTML("vote.approve_text")})]}),e?(0,f.jsxs)("button",{className:"j-large-btn is-valid",disabled:!0,children:[o.Ay.get("v2.sign_in_wallet"),(0,f.jsx)("span",{className:"siging-icon"})]}):(0,f.jsx)("button",{className:"j-large-btn is-valid",onClick:this.toApprove,children:o.Ay.get("vote.approve_btn")}),s&&"approve"===i&&(0,f.jsxs)("div",{className:"j-error-tip wallet-reject",children:[(0,f.jsx)("span",{className:"j-error-img"}),(0,f.jsx)("div",{children:o.Ay.get("v2.reject_in_wallet")})]})]})},this.state={lang:window.localStorage.getItem("lang")||o.Ay.options.currentLocale,isSigning:!1,jstInputValue:"",inputErrorText:"",approveStatus:null,approving:!1}}render(){const{swapJstToVoteModalVisible:e}=this.props.lend,{approveStatus:t}=this.state;let s=t?o.Ay.get("vote.myvote_deposit"):o.Ay.get("deposit.confirm_approve");return(0,f.jsx)(V.A,{visible:e,title:s,width:400,footer:null,className:"j-modal header-border swap-jst-to-vote-pop",onCancel:()=>this.hideSwapJstToVotePop(),closable:!0,maskClosable:!1,centered:!0,getContainer:()=>document.querySelector(".j-wrapper"),children:t?this.renderSwapPop():this.renderApprovePop()})}})||T)||T)||T)||T;var F,H=s(69185);const M="succeeded",E="failed",R="pending",B="waiting";const L=(0,r.WQ)("network")(F=(0,r.WQ)("system")(F=(0,r.WQ)("lend")(F=(0,r.PA)(F=class extends i.Component{constructor(e){var t;super(e),t=this,this.componentDidMount=async()=>{document.title="Vote - JustLend DAO",this.props.lend.setData({voteDetailData:null}),this.getProposalIdFromUrl(),this.startInterval(),window.addEventListener("resize",this.handleResize)},this.startInterval=async()=>{this.timerInterval||(this.state.proposalId&&await this.props.lend.getVoteDetail(this.state.proposalId),this.timerInterval=setInterval((async()=>{this.state.proposalId&&await this.props.lend.getVoteDetail(this.state.proposalId)}),3e4))},this.handleResize=()=>{this.setState({isMobileLayout:window.innerWidth<799})},this.getProposalIdFromUrl=()=>{this.props.lend.setData({lockNum:(0,w.gH)(0)});const e=(0,w.Ez)("proposalId");this.setState({proposalId:e},(()=>{this.props.lend.getVoteDetail(e)}))},this.getFormattedTimeString=e=>new Date(e).format("yyyy-MM-dd h:m:s"),this.showRedeemFromVotePop=()=>{const{proposalId:e}=this.state;this.props.lend.setData({redeemFromVotePop:!0,redeemFromVotePopProposalId:e})},this.voteAgainstButtonOnClick=()=>{const{proposalId:e}=this.state,{addVote:t}=this.props.lend;0!==this.props.network.isRightChain?0!==this.props.network.isMainNetwork?"yes"!==t&&this.props.lend.setData({voteForPop:!0,voteForPopIsFor:!1,voteForPopProposalId:e}):this.props.network.showNetworkErrorModal():this.props.network.changeChain()},this.voteForButtonOnClick=()=>{const{proposalId:e}=this.state,{addVote:t}=this.props.lend;0!==this.props.network.isRightChain?0!==this.props.network.isMainNetwork?"no"!==t&&this.props.lend.setData({voteForPop:!0,voteForPopIsFor:!0,voteForPopProposalId:e}):this.props.network.showNetworkErrorModal():this.props.network.changeChain()},this.renderStatusItem=function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;return(0,f.jsxs)("div",{className:l()("status-history",{expandable:s},{collapsed:i}),children:[(0,f.jsx)("div",{className:l()("expand-button",{visible:s}),onMouseEnter:()=>{t.setState({shouldExpandTimeline:!0}),window.gtag("event","PC_vote_detail_expand",{event_category:"PC_V1.5",event_label:"vote_detail_expand"})},onMouseLeave:()=>{t.setState({shouldExpandTimeline:!1})},children:o.Ay.get("v2.vote.status_expand_btn")}),(0,f.jsx)("div",{className:l()("timeline-icon",{succeeded:e.icon===M},{failed:e.icon===E},{pending:e.icon===R},{waiting:e.icon===B})}),(0,f.jsxs)("div",{className:l()("status-title",{"hover-enabled":e.hoverHint}),children:[e.title,e.hoverHint&&(0,f.jsx)("div",{className:"hover-hint",children:e.hoverHint})]}),(0,f.jsx)("div",{className:"status-time",children:e.timeString}),(0,f.jsx)("div",{className:"timeline-dot"}),(0,f.jsx)("div",{className:"timeline-arrow-dot"})]},"history"+e.status+"_"+a)},this.loadingRender=()=>{const{theme:e}=this.props.lend,{mobile:t}=this.state;return(0,f.jsx)("div",{className:"vote-detail-skeleton",children:(0,f.jsxs)("div",{className:"vote-detail",children:[(0,f.jsx)("div",{className:"back-to-vote-button",children:(0,w.eB)()}),(0,f.jsxs)("div",{className:"vote-detail-header",children:[(0,f.jsxs)("div",{className:"vote-detail-title-container",children:[(0,f.jsx)("div",{className:"vote-detail-title",children:(0,w.eB)()}),(0,f.jsx)("div",{className:"vote-detail-links-row",children:(0,w.eB)()}),(0,f.jsx)("div",{className:"vote-detail-title",children:(0,w.eB)()})]}),(0,f.jsx)("div",{className:"vote-detail-status-box content-container",children:t?(0,f.jsxs)(f.Fragment,{children:[new Array(2).fill(1).map((()=>(0,f.jsxs)("div",{className:"status-history",children:[(0,f.jsx)("div",{className:"timeline-icon circle "}),(0,f.jsx)("div",{className:"status-title",children:(0,w.eB)()}),(0,f.jsx)("div",{className:"status-time",children:(0,w.eB)()})]}))),(0,f.jsxs)("div",{className:"status-history",children:[(0,f.jsx)("div",{className:"timeline-icon  circle"}),(0,f.jsx)("div",{className:"status-title",children:(0,w.eB)()}),(0,f.jsx)("div",{className:"status-time",children:(0,w.eB)()})]})]}):new Array(3).fill(1).map((()=>(0,w.eB)()))})]}),(0,f.jsxs)("div",{className:"progress-bar-container no-vote",children:[(0,f.jsxs)("div",{className:"support-progress-bar-container",children:[(0,f.jsxs)("div",{className:"progress-bar-title show-vote-icon",children:[(0,w.eB)(),t&&(0,w.eB)()]}),(0,f.jsx)("div",{className:"progress-bar-background",children:(0,f.jsx)("div",{className:"progress-bar"})}),(0,f.jsx)("div",{className:"progress-bar"}),(0,f.jsx)("div",{className:"progress-bar square-upper-half"})]}),(0,f.jsxs)("div",{className:"against-progress-bar-container zero-vote",children:[(0,f.jsxs)("div",{className:"progress-bar-title",children:[(0,w.eB)(),t&&(0,w.eB)()]}),(0,f.jsx)("div",{className:"progress-bar-background",children:(0,f.jsx)("div",{className:"progress-bar"})}),(0,f.jsx)("div",{className:"progress-bar"}),(0,f.jsx)("div",{className:"progress-bar square-upper-half"})]})]}),(0,f.jsxs)("div",{className:"redeem-vote-bar content-container content-container-shadow",children:[(0,f.jsx)("div",{className:"bar-title",children:(0,w.eB)()}),(0,f.jsx)("button",{className:"bar-action-btn",children:(0,w.eB)()})]}),(0,f.jsxs)("div",{className:"vote-detail-info-container content-container content-container-shadow",children:[(0,f.jsx)("div",{className:"vote-detail-info-header",children:(0,w.eB)()}),t?(0,f.jsx)("div",{className:"vote-detail-info-text "+("white"!==e?"dark":""),children:new Array(2).fill(1).map((()=>(0,w.eB)()))}):(0,f.jsxs)("div",{className:"vote-detail-info-text "+("white"!==e?"dark":""),children:[new Array(6).fill(1).map((()=>(0,w.eB)())),(0,f.jsx)("div",{style:{margin:"25px 0 20px"},children:(0,w.eB)({rows:12})}),new Array(2).fill(1).map((()=>(0,w.eB)()))]})]})]})})},this.editVoteDetail=()=>{this.setState({editMode:1})},this.previewVoteDetail=()=>{this.setState({editMode:2})},this.state={isMobileLayout:window.innerWidth<799,lang:window.localStorage.getItem("lang")||o.Ay.options.currentLocale,proposalId:void 0,shouldExpandTimeline:!1,mobile:(0,a.A)(window.navigator).any,editMode:0,previewDetailContent:null,env:{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_ENV}}componentWillUnmount(){clearInterval(this.timerInterval),this.timerInterval=null,window.removeEventListener("resize",this.handleResize)}render(){const{lang:e,isMobileLayout:t,shouldExpandTimeline:s}=this.state,{theme:i,voteDetailData:a,addVote:n,lockNum:r}=this.props.lend,{isConnected:p}=this.props.network,h="en-US"===e;var m,g,u,V,k,T,F,B,L,W,J,O,q,Q,z=[],U=!1;if(a){m=h?a.title.split("&&")[1]:a.title.split("&&")[0],g=a.proposalId,u=h?a.content.split("&&&&&&&&")[0]:a.content.split("&&&&&&&&")[1];const e=a.state;z.push({status:"creation",icon:M,title:o.Ay.get("v2.vote.status_created"),timeString:this.getFormattedTimeString(a.activeTime)}),2!=e&&z.push({status:"voting",icon:M,title:o.Ay.get("v2.vote.voting_begun"),timeString:this.getFormattedTimeString(a.activeTime)}),e<2&&z.push({status:"confirmingVotingResult",icon:R,title:o.Ay.get("v2.vote.status_result_confirm"),timeString:this.getFormattedTimeString(a.endTime)}),2==e&&z.push({status:"cancelCreation",icon:E,title:o.Ay.get("v2.vote.status_cancel_creation"),timeString:this.getFormattedTimeString(a.cancelTime)}),3==e&&z.push({status:"failed",icon:E,title:o.Ay.get("v2.vote.status_failed"),hoverHint:o.Ay.get("v2.vote.status_hint_insufficient_vote_count"),timeString:this.getFormattedTimeString(a.endTime)}),e>3&&6!=e&&z.push({status:"passed",icon:M,title:o.Ay.get("v2.vote.status_passed"),timeString:this.getFormattedTimeString(a.endTime)}),4==e&&z.push({status:"waitForQueue",icon:R,title:o.Ay.get("v2.vote.status_wait_for_queue"),timeString:this.getFormattedTimeString(a.endTime)}),5!=e&&7!=e||z.push({status:"queuing",icon:M,title:o.Ay.get("v2.vote.status_queuing"),timeString:this.getFormattedTimeString(a.queuedTime)}),6==e&&z.push({status:"cancelled",icon:E,title:o.Ay.get("v2.vote.status_expired"),hoverHint:"",timeString:this.getFormattedTimeString(a.queuedTime+2592e5)}),7==e&&z.push({status:"executed",icon:M,title:o.Ay.get("v2.vote.status_executed"),hoverHint:"",timeString:this.getFormattedTimeString(a.executedTime)}),U=z.length>3&&!t,V="6"!=e;const s=(0,w.gH)(a.forVotes).div(y.Ay.tokenDefaultPrecision),i=(0,w.gH)(a.againstVotes).div(y.Ay.tokenDefaultPrecision);if(k=s.gt(0),T=i.gt(0),F=(0,w.gH)(s).eq(0)?"0":(0,w.gH)(s).lt(.001)?"< 0.001":(0,w.ZV)(s,3),B=(0,w.gH)(i).eq(0)?"0":(0,w.gH)(i).lt(.001)?"< 0.001":(0,w.ZV)(i,3),s<=0&&i<=0)L=-1;else if(s<=0)L=0;else if(i<=0)L=100;else{var Z=s/i;L=(0,w.gH)(Z/(1+Z)*100).integerValue(w.gH.ROUND_HALF_UP)}var $=(0,w.gH)(r).gt(0);W=0==e||1==e,O="no"==n&&$,J="yes"==n&&$;const l=(0,w.gH)(r).div(y.Ay.tokenDefaultPrecision);q=(0,w.gH)(l).eq(0)?"0":(0,w.gH)(l).lt(.001)?"< 0.001":(0,w.ZV)(l,3),Q=p&&"1"!=e&&"0"!=e&&$}let K=window.localStorage.getItem("previewDetailContent");return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:"j-wrapper "+i+(y.Ay.winterThemeVisible?" snow-show":""),children:[y.Ay.winterThemeVisible&&(0,f.jsx)(x.A,{fromPage:"voteDetail"}),(0,f.jsx)(A.A,{}),(0,f.jsx)(S.A,{pageName:"voteDetail"}),(0,f.jsx)("div",{className:"j-container",children:a?(0,f.jsxs)("div",{className:"vote-detail",children:[(0,f.jsx)(j.N_,{className:"back-to-vote-button",to:"/voteNew",children:o.Ay.get("v2.vote.back_to_vote_btn")}),(0,f.jsxs)("div",{className:"vote-detail-header",children:[(0,f.jsxs)("div",{className:"vote-detail-title-container",children:[(0,f.jsxs)("div",{className:"vote-detail-title",children:[m,(0,f.jsx)("span",{className:"proposal-id-tag",children:"#"+g})]}),(0,f.jsx)("div",{className:"vote-detail-links-row",children:(0,f.jsx)("a",{className:"link-item",href:y.Ay.tronscanUrl+"/address/"+(null===a||void 0===a?void 0:a.proposer),target:"tronscan",onClick:window.gtag("event","PC_vote_on_chain_info",{event_category:"PC_V1.5",event_label:"vote_on_chain_info"}),children:o.Ay.get("v2.vote.header_chain_info_link")})})]}),(0,f.jsxs)("div",{className:l()("vote-detail-status-box content-container",{"invisible-content":U}),children:[U?z.map(((e,t)=>{if(0===t||t>z.length-3)return this.renderStatusItem(e,0===t,!1,t)})):z.map(((e,t)=>this.renderStatusItem(e,!1,!1,t))),U&&(0,f.jsx)("div",{className:l()("vote-detail-status-box content-container expandable-display",{expanding:s}),children:s?z.map(((e,t)=>this.renderStatusItem(e,!1,!1,t))):z.map(((e,t)=>0===t||t>z.length-3?this.renderStatusItem(e,0===t,!1,t):this.renderStatusItem(e,0===t,!0,t)))})]})]}),V&&(0,f.jsxs)("div",{className:"progress-bar-container"+(W?"":" no-vote"),children:[(0,f.jsxs)("div",{className:l()("support-progress-bar-container",{"zero-vote":!k}),style:{flexBasis:L+"%"},children:[(0,f.jsxs)("div",{className:l()("progress-bar-title",{"show-vote-icon":J}),children:[o.Ay.get("v2.vote.support"),J&&(0,f.jsx)("div",{className:"vote-icon"})]}),(0,f.jsx)("div",{className:"progress-bar-vote-string",children:F}),J&&(0,f.jsxs)("div",{className:"wallet-vote-container",children:[(0,f.jsx)("div",{className:"vote-icon",children:(0,f.jsx)("div",{className:"voted-hint",children:o.Ay.get("v2.vote.voted_before")})}),(0,f.jsx)("div",{className:"wallet-vote-count",children:q})]}),W&&(0,f.jsx)("button",{className:"action-button",disabled:!p||O,onClick:()=>{this.voteForButtonOnClick(),window.gtag("event",""+(J?"PC_add_vote_for":"PC_vote_for"),{event_category:"PC_V1.5",event_label:""+(J?"add_vote":"vote"),value:"for"})},children:o.Ay.get(J?"v2.vote.add_vote_btn":"v2.vote.support")}),(0,f.jsx)("div",{className:"progress-bar-background",children:(0,f.jsx)("div",{className:"progress-bar"})}),(0,f.jsx)("div",{className:"progress-bar"}),(0,f.jsx)("div",{className:"progress-bar square-upper-half"})]}),(0,f.jsxs)("div",{className:l()("against-progress-bar-container",{"zero-vote":!T}),style:{flexBasis:100-L+"%"},children:[(0,f.jsxs)("div",{className:l()("progress-bar-title",{"show-vote-icon":O}),children:[o.Ay.get("v2.vote.against"),O&&(0,f.jsx)("div",{className:"vote-icon"})]}),(0,f.jsx)("div",{className:"progress-bar-vote-string",children:B}),O&&(0,f.jsxs)("div",{className:"wallet-vote-container",children:[(0,f.jsx)("div",{className:"vote-icon",children:(0,f.jsx)("div",{className:"voted-hint",children:o.Ay.get("v2.vote.voted_before")})}),(0,f.jsx)("div",{className:"wallet-vote-count",children:q})]}),W&&(0,f.jsx)("button",{className:"action-button",disabled:!p||J,onClick:()=>{this.voteAgainstButtonOnClick(),window.gtag("event",""+(O?"PC_add_vote_against":"PC_vote_against"),{event_category:"PC_V1.5",event_label:""+(O?"add_vote":"vote"),value:"against"})},children:o.Ay.get(O?"v2.vote.add_vote_btn":"v2.vote.against")}),(0,f.jsx)("div",{className:"progress-bar-background",children:(0,f.jsx)("div",{className:"progress-bar"})}),(0,f.jsx)("div",{className:"progress-bar"}),(0,f.jsx)("div",{className:"progress-bar square-upper-half"})]})]}),!p&&(0,f.jsxs)("div",{className:"connect-wallet-hint-bar content-container content-container-shadow",children:[(0,f.jsx)("div",{className:"bar-title",children:o.Ay.get("v2.vote.connect_wallet_title")}),"disabled"===this.props.lend.serviceInnerStatus?(0,f.jsx)(d.A,{title:o.Ay.get("season.can_not_connect"),overlayClassName:"j-tooltip-dropdown season "+i,arrowPointAtCenter:!0,placement:"bottom",children:(0,f.jsx)("button",{className:"bar-action-btn season",onClick:()=>{this.props.lend.setData({noServiceModalAllVisible:!0})},children:o.Ay.get("v2.vote.connect_wallet_btn")})}):(0,f.jsx)("button",{className:"bar-action-btn",onClick:()=>this.props.network.connectWalletV2(),children:o.Ay.get("v2.vote.connect_wallet_btn")})]}),Q&&(0,f.jsxs)("div",{className:"redeem-vote-bar content-container content-container-shadow",children:[(0,f.jsx)("div",{className:"bar-title",children:o.Ay.get("v2.vote.redeem_vote_title",{value:q})}),(0,f.jsx)("button",{className:"bar-action-btn",disabled:!p,onClick:()=>{this.showRedeemFromVotePop(),window.gtag("event","PC_vote_detail_recycle",{event_category:"PC_V1.5",event_label:"vote_detail_recycle"})},children:o.Ay.get("v2.vote.redeem_vote_btn")})]}),(0,f.jsxs)("div",{className:"vote-detail-info-container content-container content-container-shadow",children:[(0,f.jsxs)("div",{className:"vote-detail-info-header",children:[o.Ay.get("v2.vote.info_title"),"test"===this.state.env&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("span",{className:"ml-20 link",onClick:()=>this.editVoteDetail(),children:["Edit",(0,f.jsx)(_,{className:"ml-5"})]}),this.state.previewDetailContent&&(0,f.jsx)(c.A,{className:"ml-20",onClick:()=>window.localStorage.setItem("previewDetailContent",this.state.previewDetailContent),children:"SaveToCache"}),K&&(0,f.jsx)(c.A,{className:"ml-10",onClick:()=>{K=window.localStorage.getItem("previewDetailContent"),this.setState({editMode:2,previewDetailContent:K})},children:"RestoreFromCache"})]})]}),1===this.state.editMode&&"test"===this.state.env?(0,f.jsxs)("div",{className:l()("vote-detail-info-text",{dark:"white"!==i}),children:[(0,f.jsx)(v.A.TextArea,{value:this.state.previewDetailContent,onChange:e=>this.setState({previewDetailContent:e.target.value}),autoSize:{minRows:10}}),(0,f.jsx)(c.A,{className:"mt-10",onClick:()=>this.previewVoteDetail(),children:"Preview"})]}):2===this.state.editMode&&"test"===this.state.env?(0,f.jsx)("div",{className:l()("vote-detail-info-text",{dark:"white"!==i}),dangerouslySetInnerHTML:{__html:this.state.previewDetailContent}}):(0,f.jsx)("div",{className:l()("vote-detail-info-text",{dark:"white"!==i}),dangerouslySetInnerHTML:{__html:u}})]})]}):this.loadingRender()}),(0,f.jsx)(N.A,{}),(0,f.jsx)(C,{}),(0,f.jsx)(I,{}),(0,f.jsx)(D,{}),(0,f.jsx)(H.A,{}),(0,f.jsx)(P.A,{})]}),(0,f.jsx)(b.A,{theme:i})]})}})||F)||F)||F)||F;var W;const J=(0,r.WQ)("network")(W=(0,r.PA)(W=class extends i.Component{componentDidMount(){this.props.network.setData({routeName:"vote"})}render(){return(0,f.jsx)("div",{children:(0,f.jsx)(L,{})})}})||W)||W},80646:()=>{}}]);